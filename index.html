<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Retro Diary</title>

  <!-- PWA / manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#3a241c"/>

  <!-- Bas-stilar + teman -->
  <link rel="stylesheet" href="styles.css">
  <link id="themeLink" rel="stylesheet" href="theme_light.css">
  <link rel="stylesheet" href="theme_memory.css">

  <noscript>
    <style>
      body { padding: 1rem; }
      .nojs { background: #ffc; border: 1px solid #cc9; padding: .75rem; }
    </style>
  </noscript>
</head>

<body class="locked">
  <noscript><div class="nojs" data-i18n="no_js">Den hÃ¤r appen krÃ¤ver JavaScript.</div></noscript>

  <!-- Menyknapp -->
  <button id="menuToggle" aria-label="Meny" title="Meny"></button>

  <!-- Bok-layout -->
  <div class="book" aria-label="Retro Diary">
    <!-- InnehÃ¥llssida -->
    <section class="page" id="leftPage" aria-labelledby="tocTitle">
      <h2 id="tocTitle" data-i18n="contents">InnehÃ¥ll</h2>

      <div class="searchRow" role="search">
        <input id="searchInput" type="search" placeholder="SÃ¶k titel/textâ€¦" data-i18n-placeholder="search_ph">
        <button id="searchBtn" class="btn" data-i18n="search">SÃ¶k</button>
        <button id="clearSearchBtn" class="btn" data-i18n="clear">Rensa</button>
      </div>

      <ul id="entries" aria-live="polite"></ul>
    </section>

    <!-- Editor -->
    <section class="page" id="rightPage" aria-labelledby="editorTitle">
      <div id="toolbar" role="toolbar" aria-label="Textverktyg">
        <!-- Grupp 1 -->
        <div class="group">
          <button id="boldBtn" class="btn" title="Fet (Ctrl+B)" aria-label="Fet"><b>B</b></button>
          <button id="italicBtn" class="btn" title="Kursiv (Ctrl+I)" aria-label="Kursiv"><i>I</i></button>
          <button id="underlineBtn" class="btn" title="Understryk (Ctrl+U)" aria-label="Understryk"><u>U</u></button>
          <button id="strikeBtn" class="btn" title="Genomstruken" aria-label="Genomstruken">S</button>
          <button id="clearFmtBtn" class="btn" title="Rensa formatering" aria-label="Rensa formatering">â¨‚</button>
        </div>
        <!-- Grupp 2 -->
        <div class="group">
          <label class="sr-only" for="blockSelect" data-i18n="block">Block</label>
          <select id="blockSelect" title="Block">
            <option value="p"  data-i18n="block_p">BrÃ¶dtext</option>
            <option value="h1" data-i18n="block_h1">Rubrik 1</option>
            <option value="h2" data-i18n="block_h2">Rubrik 2</option>
            <option value="h3" data-i18n="block_h3">Rubrik 3</option>
            <option value="blockquote" data-i18n="block_quote">Citat</option>
          </select>
          <button id="leftBtn"   class="btn" aria-label="VÃ¤nster">âŸ¸</button>
          <button id="centerBtn" class="btn" aria-label="Centrera">â‡”</button>
          <button id="rightBtn"  class="btn" aria-label="HÃ¶ger">âŸ¹</button>
          <button id="justifyBtn" class="btn" aria-label="Justera">â‰‹</button>
          <button id="ulBtn" class="btn" aria-label="Punktlista">â€¢ Lista</button>
          <button id="olBtn" class="btn" aria-label="Numrerad lista">1. Lista</button>
          <button id="hrBtn" class="btn" aria-label="Horisontell linje">â€”</button>
          <button id="undoBtn" class="btn" aria-label="Ã…ngra">â†¶</button>
          <button id="redoBtn" class="btn" aria-label="GÃ¶r om">â†·</button>
        </div>
        <!-- Grupp 3 -->
        <div class="group">
          <label class="swatch" title="TextfÃ¤rg"><input id="foreColor" type="color"></label>
          <label class="swatch" title="Markering"><input id="hiliteColor" type="color" value="#fff7a8"></label>
          <label class="swatch" title="Bakgrund block"><input id="blockBg" type="color" value="#ffffff"></label>
          <select id="fontFamily" title="Font" style="min-width:160px"></select>
          <select id="fontSize" title="Storlek">
            <option>14px</option><option selected>16px</option><option>18px</option>
            <option>20px</option><option>22px</option><option>24px</option><option>28px</option>
          </select>
        </div>
        <!-- Grupp 4 -->
        <div class="group">
          <button id="linkBtn" class="btn" aria-label="Infoga lÃ¤nk">ğŸ”—</button>
          <button id="unlinkBtn" class="btn" aria-label="Ta bort lÃ¤nk">âœ‚ï¸ğŸ”—</button>
          <button id="btnImage" class="btn" aria-label="Infoga bild">ğŸ–¼ï¸</button>
          <button id="btnImgSmaller" class="btn" aria-label="Mindre bild">â–</button>
          <button id="btnImgBigger" class="btn" aria-label="StÃ¶rre bild">â•</button>
          <button id="btnAudio" class="btn" aria-label="Infoga ljud">ğŸµ</button>
          <button id="emojiBtn" class="btn" aria-label="Emoji">ğŸ˜Š</button>
          <button id="stampBtn" class="btn" aria-label="Infoga datum/tid">ğŸ—“ï¸</button>
          <button id="copyBtn" class="btn" aria-label="Kopiera">â˜</button>
          <button id="pasteBtn" class="btn" aria-label="Klistra in">ğŸ“‹</button>
          <button id="ttsBtn" class="btn" aria-label="LÃ¤s upp">ğŸ”Š</button>
          <button id="favoriteBtn" class="btn" aria-label="Favorit">â˜†</button>
          <button id="quickThemeBtn" class="btn" aria-label="Tema snabbvÃ¤xling">ğŸŒ“</button>
        </div>
      </div>

      <h2 id="editorTitle" class="sr-only" data-i18n="editor">Editor</h2>

      <input id="titleInput" class="titleInput" placeholder="Titelâ€¦" data-i18n-placeholder="title_ph">
      <div id="dateLine" aria-live="polite"></div>
      <div id="editor" contenteditable="true" spellcheck="true" aria-label="Skriv hÃ¤râ€¦"></div>

      <div id="actions">
        <button id="newBtn" class="btn" data-i18n="new_page">Ny sida</button>
        <button id="saveBtn" class="btn" data-i18n="save">Spara</button>
        <button id="deleteBtn" class="btn danger" data-i18n="delete">Radera</button>
        <button id="lockBtn" class="btn" data-i18n="lock">LÃ¥s</button>
      </div>
    </section>
  </div>

  <!-- Sidomeny -->
  <aside id="menu" aria-hidden="true">
    <h2 data-i18n="menu">Meny</h2>
    <button id="switchUserBtn" class="btn" data-i18n="switch_user">Byt anvÃ¤ndare</button>
    <button id="exportBtn" class="btn" data-i18n="export">Exportera (.json)</button>
    <input id="importInput" type="file" accept="application/json" hidden>
    <button id="importBtn" class="btn" data-i18n="import">Importera (.json)</button>
    <label for="themeSelect" data-i18n="theme">Tema</label>
    <select id="themeSelect"><option value="light">Ljust</option><option value="dark">MÃ¶rkt</option></select>
    <label for="langSelectMenu" data-i18n="language">SprÃ¥k</label>
    <select id="langSelectMenu"><option value="sv">Svenska</option><option value="en">English</option></select>
    <button id="memoryBtn" class="btn" data-i18n="memory_mode">MinneslÃ¤ge</button>
    <button id="wipeBtn" class="btn danger" data-i18n="wipe_all">Rensa ALL lokal data</button>
    <hr>
    <nav class="menu-links">
      <a href="about.html" data-i18n="about">Om appen</a> â€¢
      <a href="help.html" data-i18n="help">HjÃ¤lp</a> â€¢
      <a href="privacy.html" data-i18n="privacy">Sekretess</a>
    </nav>
    <p class="copyright"><small>Â© Conri Turesson</small></p>
  </aside>
<!-- LÃ¥sskÃ¤rm -->
  <div id="lockscreen" class="lock" aria-modal="true" role="dialog">
    <div class="card">
      <h2 data-i18n="lock_title">ğŸ”’ Retro Diary</h2>

      <input type="text" id="userInput"
             placeholder="AnvÃ¤ndarnamn"
             data-i18n-placeholder="username_ph">

      <input type="password" id="passInput"
             placeholder="Dagbokens lÃ¶senord"
             data-i18n-placeholder="password_ph">

      <div class="row">
        <button id="setPassBtn" class="btn" data-i18n="set_pass"
          onclick="window.Lock?.setInitialPass?.(
            document.getElementById('userInput').value,
            document.getElementById('passInput').value
          )">
          SÃ¤tt nytt lÃ¶sen
        </button>

        <button id="unlockBtn" class="btn" data-i18n="unlock"
          onclick="window.Lock?.unlock?.(
            document.getElementById('userInput').value,
            document.getElementById('passInput').value
          )">
          LÃ¥s upp
        </button>
      </div>

      <button id="wipeLocalOnLock" class="btn danger" data-i18n="wipe_all"
        onclick="window.Lock?.wipeCurrentUser?.()">
        Rensa ALL lokal data
      </button>

      <p id="status" aria-live="polite"></p>

      <div class="lang-row">
        <label for="langSelectLock">Language / SprÃ¥k</label>
        <select id="langSelectLock">
          <option value="sv">Svenska</option>
          <option value="en">English</option>
        </select>
      </div>

      <div id="aboutBox">
        <a href="about.html" data-i18n="about">Om appen</a> â€¢
        <a href="help.html" data-i18n="help">HjÃ¤lp</a> â€¢
        <a href="privacy.html" data-i18n="privacy">Sekretess</a><br>
        <small>Â© Conri Turesson</small>
      </div>
    </div>
  </div>

  <!-- Dolda filinputs -->
  <input id="imgFile" type="file" accept="image/*" hidden>
  <input id="audioFile" type="file" accept="audio/*" hidden>

  <!-- Force-update -->
  <button id="forceUpdateBtn" title="Rensa cache och ladda om">âŸ³</button>

  <!-- JS -->
  <script src="fonts_db.js"></script>
  <script src="i18n.js"></script>
  <script type="module" src="app.js"></script>
  <script>
  console.log('[diag] inline index.js running. Lock present now?', !!window.Lock);
  document.addEventListener('DOMContentLoaded', ()=>console.log('[diag] DOMContentLoaded (inline)'));
  window.addEventListener('load', ()=>console.log('[diag] window.load (inline)'));

  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistrations()
      .then(regs => console.log('[diag] SW registrations:', regs.map(r => r.active?.scriptURL || r.scope)));
  }

  // Visa snabbt vilka viktiga element som finns
  const must = ['setPassBtn','unlockBtn','wipeLocalOnLock','userInput','passInput','lockscreen'];
  console.log('[diag] DOM ids present:', Object.fromEntries(must.map(id => [id, !!document.getElementById(id)])));
  </script>
</body>
</html>
