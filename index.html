<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Retro Diary</title>

  <!-- PWA -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#2d2d2d">

  <!-- Ikoner -->
  <link rel="icon" href="icon-192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="icon-192.png">

  <link rel="stylesheet" href="styles.css">

  <!-- Supabase (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Milj√∂variabler f√∂r klienten -->
  <script>
    window.__env = {
      SUPABASE_URL: "https://ehjsihadlrjbfocodxay.supabase.co",
      SUPABASE_ANON_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVoanNpaGFkbHJqYmZvY29keGF5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2MjY0NDcsImV4cCI6MjA3MzIwMjQ0N30.AMSMbuaVoQTY6hpcmqqHhf00EImk7VTytcegrLmHmQw"
    };
  </script>
</head>
<body>
  <div class="frame">
    <div class="titlebar">
      <div class="brand">
        <div class="badge"></div>
        <div>Retro Diary</div>
      </div>

      <div class="actions">
        <button id="newEntryBtn">Ny sida</button>

        <div class="menu" id="menuWrap">
          <button id="menuBtn" class="ghost">‚ãÆ</button>
          <div id="menuDrop" class="dropdown" hidden>
            <button id="exportBtn">Exportera (krypterad .json)</button>
            <label class="filebtn">
              Importera (krypterad .json)
              <input id="importFile" type="file" accept="application/json" hidden>
            </label>
            <hr>
            <button id="enableBioBtn">Aktivera biometri</button>
            <button id="disableBioBtn">St√§ng av biometri</button>
            <hr>
            <button id="showRecoveryBtn">Visa/Skapa √•terst√§llningskod</button>
            <button id="resetPasswordBtn">Byt/√Öterst√§ll l√∂senord</button>
            <hr>
            <button id="wipeLocalBtn" class="danger">Rensa lokala data (denna enhet)</button>
            <hr>
            <button id="logoutBtn" class="ghost">Logga ut</button>
          </div>
        </div>

        <button id="lockBtn" class="ghost">L√•s</button>
      </div>
    </div>

    <div class="wrap">
      <aside class="sidebar">
        <div class="entry-list" id="list"></div>
      </aside>

      <main class="content">
        <div class="date-line" id="dateLine"></div>

        <!-- RTF-verktygsrad -->
        <div class="rt-toolbar" role="toolbar" aria-label="Textformat">
          <div class="btn-group">
            <button data-cmd="bold" title="Fet">B</button>
            <button data-cmd="italic" title="Kursiv"><i>I</i></button>
            <button data-cmd="underline" title="Understruken"><u>U</u></button>
            <button data-cmd="strikeThrough" title="Genomstruken">S</button>
          </div>
          <div class="btn-group">
            <button data-block="h1" title="Rubrik 1">H1</button>
            <button data-block="h2" title="Rubrik 2">H2</button>
            <button data-block="p" title="Br√∂dtext">¬∂</button>
          </div>
          <div class="btn-group">
            <button data-cmd="insertUnorderedList" title="Punktlista">‚Ä¢ List</button>
            <button data-cmd="insertOrderedList" title="Numrerad lista">1. List</button>
            <button data-cmd="formatBlock" data-value="blockquote" title="Citat">‚ùù ‚ùû</button>
          </div>
          <div class="btn-group">
            <input type="color" id="foreColor" title="Textf√§rg">
            <button id="applyForeColor" title="Applicera textf√§rg">Textf√§rg</button>
            <input type="color" id="hiliteColor" title="Markering">
            <button id="applyHiliteColor" title="Applicera markering">Markera</button>
          </div>
          <div class="btn-group">
            <button id="insertLinkBtn" title="Infoga l√§nk">L√§nk</button>
            <button id="insertIconBtn" title="Infoga ikon/emoji">üî£</button>
            <button id="clearFormatBtn" title="Rensa formatering">Rensa</button>
          </div>
        </div>

        <div id="editor" class="editor" contenteditable="true" spellcheck="true"
             data-placeholder="Skriv fritt. Allt krypteras lokalt innan det synkas."></div>

        <div class="toolbar">
          <button id="saveBtn">Spara</button>
          <button id="deleteBtn" class="danger">Radera</button>
        </div>
        <div class="stamp" id="stamp"></div>
      </main>
    </div>

    <!-- L√•ssk√§rm -->
    <div class="lockscreen" id="lockscreen" hidden>
      <div class="lockcard">
        <h2>üîí L√•s upp dagboken</h2>
        <p class="hint">Skapa konto f√∂r synk, eller logga in om du redan har. Dagbokens krypteringsl√∂sen √§r separat.</p>

        <fieldset class="account">
          <legend>Konto</legend>
          <div class="field"><input id="email" type="email" placeholder="E-post"></div>
          <div class="field"><input id="acctPass" type="password" placeholder="Konto-l√∂senord"></div>
          <div class="field">
            <button id="signupBtn" class="ghost">Skapa konto</button>
            <button id="signinBtn" class="ghost">Logga in</button>
          </div>
          <div class="tiny" id="authStatus"></div>
        </fieldset>

        <fieldset>
          <legend>Dagbokens l√∂sen (kryptering)</legend>
          <div class="field">
            <input id="pass" type="password" autocomplete="current-password" placeholder="Dagbokens l√∂senord">
          </div>
          <div class="field">
            <button id="unlockBtn">L√•s upp</button>
            <button id="bioUnlockBtn" class="ghost">Biometrisk uppl√•sning</button>
          </div>
          <div class="status" id="status"></div>
          <div class="tiny">
            <button id="useRecoveryBtn" class="linklike">Har √•terst√§llningskod?</button>
          </div>
        </fieldset>
      </div>
    </div>

    <!-- √Öterst√§ll/byt dagboksl√∂sen med √•terst√§llningskod -->
    <dialog id="resetDialog">
      <h3>Byt/√Öterst√§ll dagboksl√∂sen</h3>

      <div class="field">
        <input id="rcInput" type="text" placeholder="√Öterst√§llningskod (XXXX-XXXX-XXXX-XXXX)" inputmode="latin-prose" />
      </div>

      <div class="field">
        <input id="newPass1" type="password" placeholder="Nytt dagboksl√∂sen" />
      </div>
      <div class="field">
        <input id="newPass2" type="password" placeholder="Upprepa nytt dagboksl√∂sen" />
      </div>

      <div class="field">
        <button id="applyReset">Spara nytt</button>
        <button id="cancelReset" class="ghost">Avbryt</button>
      </div>

      <div class="status" id="resetStatus"></div>
    </dialog>

    <!-- √Öterst√§llningskod (visa/skapa) -->
    <dialog id="recoveryDialog">
      <h3>√Öterst√§llningskod</h3>
      <p class="hint">Spara koden s√§kert (offline). Med den kan du byta dagboksl√∂senord.</p>
      <div class="field">
        <input id="recoveryCode" type="text" readonly>
        <button id="copyRecovery" class="ghost">Kopiera</button>
      </div>
      <div class="field">
        <button id="regenRecovery">Generera ny</button>
        <button id="closeRecovery" class="ghost">St√§ng</button>
      </div>
      <p class="tiny">Ny kod ers√§tter den gamla.</p>
    </dialog>

    <!-- Ikondialog med flikar -->
    <dialog id="iconDialog">
      <h3>Ikoner & emojis</h3>
      <div class="tabs" id="iconTabs" role="tablist" aria-label="Ikonkategorier">
        <button class="tab active" data-tab="Symboler" role="tab" aria-selected="true">Symboler</button>
        <button class="tab" data-tab="Status" role="tab">Status</button>
        <button class="tab" data-tab="Element" role="tab">Element</button>
        <button class="tab" data-tab="Himmel" role="tab">Himmel</button>
        <button class="tab" data-tab="Objekt" role="tab">Objekt</button>
        <button class="tab" data-tab="Ansikten" role="tab">Ansikten</button>
        <button class="tab" data-tab="K√§rlek" role="tab">K√§rlek</button>
      </div>
      <div id="iconGrid" class="icon-grid" aria-label="Emoji palette"></div>
      <div class="field"><button id="closeIconDlg" class="ghost">St√§ng</button></div>
    </dialog>
  </div>

  <!-- Viktigt: bumpa v-numret n√§r du deployar f√∂r att forsera ny JS -->
  <script src="app.js?v=14" defer></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js'));
    }
  </script>
</body> 
</html>
